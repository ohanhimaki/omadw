@page "/MapPaymentForTime"
@using Newtonsoft.Json
@using OmaDW.Web2.Data
@inject FinancialDataService FinancialDataService
@inject IDialogService DialogService

<MudContainer Class="mt-16 px-8" MaxWidth="MaxWidth.False">
    <MudGrid>
        <MudTable
            T="Transaction"
            Items="TopRowsNotMapped">
            <HeaderContent>

                @* public DateTime Date { get; set; } *@
                @* public string Receiver { get; set; } *@
                @* public string Description { get; set; } *@
                @* public string Message { get; set; } *@
                @* public decimal Amount { get; set; } *@
                <MudTh>
                    Date
                </MudTh>
                <MudTh>
                    Saaja/Maksaja
                </MudTh>
                <MudTh>
                    Selite
                </MudTh>
                <MudTh>
                    Viesti
                </MudTh>
                <MudTh>
                    Summa
                </MudTh>
                <MudTh>
                    Ohjaa
                </MudTh>

            </HeaderContent>
            <RowTemplate>
                <MudTd>
                    @context.Date
                </MudTd>
                <MudTd>
                    @context.Receiver
                </MudTd>
                <MudTd>
                    @context.Description
                </MudTd>
                <MudTd>
                    @context.Message
                </MudTd>
                <MudTd>
                    @context.Amount
                </MudTd>
                <MudTd>
                    <MudButton OnClick="(e) => OpenToAdd(e,context) ">Ohjaa</MudButton>
                </MudTd>

            </RowTemplate>


        </MudTable>

    </MudGrid>
</MudContainer>



@code {

    protected override void OnInitialized()
    {

        Initialize();
        base.OnInitialized();
    }

    private async void Initialize()
    {
        TopRowsNotMapped = (await FinancialDataService.GetTransactions()).OrderBy(x => x.Amount).Take(10).ToList();
        await InvokeAsync(StateHasChanged);
    }

    public List<Transaction> TopRowsNotMapped { get; set; }

    private async void OpenToAdd(MouseEventArgs mouseEventArgs, Transaction transaction)
    {
        var options = new DialogOptions { CloseOnEscapeKey = true };
         var parameters = new DialogParameters();
                parameters.Add("Transaction", transaction );


         var dialog = DialogService.Show<MapPaymentForTimeForm>("Simple Dialog", parameters, options);

        var result = await dialog.Result;
        if (!result.Cancelled)
        {
            FinancialDataService.AddMapping((MapPaymentForTime)result.Data);
        }


        // write result as json
    }

}